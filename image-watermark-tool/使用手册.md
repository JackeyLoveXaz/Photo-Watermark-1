# 图片水印添加工具（ImageWatermark Tool）使用手册

## 一、工具概述

### 1. 工具定位

一款基于 Java 开发的命令行工具，支持从图片中提取 EXIF 拍摄时间（无 EXIF 信息时自动使用当前日期），并按用户配置添加文字水印，最终保存到指定子目录，适用于单张 JPEG/PNG 图片的水印处理。

### 2. 核心功能

- 自动读取图片 EXIF 拍摄时间（格式：`yyyy-MM-dd`）；
- 支持自定义水印字体大小、颜色（5 种预设颜色）、位置（3 种固定位置）；
- 按规则创建子目录保存水印图片（原目录名 +`_watermark`后缀），保留原图片格式。

### 3. 运行环境

- **Java 版本**：JDK 8 及以上（需配置环境变量，确保`java -version`可正常输出）；
- **支持系统**：Windows、MacOS、Linux；
- **支持图片格式**：JPEG（.jpg/.jpeg）、PNG（.png）。

## 二、工具获取与准备

### 1. 工具文件结构

成功编译打包后，`target`目录下会生成以下核心文件，需确保文件完整性：

```plaintext
target/
├─ image-watermark-tool-1.0-SNAPSHOT.jar  # 工具主程序JAR包
└─ lib/                                   # 依赖库目录
   └─ metadata-extractor-2.18.0.jar       # EXIF信息读取依赖
```

### 2. 环境验证

打开命令行（Windows：PowerShell/CMD；Mac/Linux：终端），执行以下命令验证 Java 环境：

```bash
java -version
```

- 正常输出示例（需为 JDK 8+）：

  ```plaintext
  java version "1.8.0_381"
  Java(TM) SE Runtime Environment (build 1.8.0_381-b09)
  Java HotSpot(TM) 64-Bit Server VM (build 25.381-b09, mixed mode)
  ```

- 若提示 “不是内部命令”，需先安装 JDK 并配置环境变量（参考 Java 官方安装指南）。

## 三、命令行使用指南

### 1. 基础命令格式

工具通过命令行参数接收配置，参数需按固定顺序传入，完整语法如下：

```bash
# 进入target目录后执行（推荐）
cd [工具所在的target目录路径]
java -jar image-watermark-tool-1.0-SNAPSHOT.jar <图片路径> <字体大小> <颜色> <位置>
```

### 2. 参数详细说明

| 参数序号 | 参数名称 | 取值规则                                                     | 示例                                                         | 注意事项                                                     |
| -------- | -------- | ------------------------------------------------------------ | ------------------------------------------------------------ | ------------------------------------------------------------ |
| 1        | 图片路径 | 本地图片的绝对路径或相对路径（支持含空格路径）               | Windows：`"E:\Photograph\旅行.jpg"`Mac：`"/Users/me/Photos/旅行.png"` | 路径含空格时需用**英文双引号**包裹；确保图片存在且为 JPEG/PNG 格式 |
| 2        | 字体大小 | 正整数（单位：像素），建议值 12~24                           | `14`、`18`                                                   | 数值过小会导致水印模糊，过大可能遮挡图片内容                 |
| 3        | 颜色     | 仅支持 5 种预设颜色（小写）：`red`（红）、`green`（绿）、`blue`（蓝）、`black`（黑）、`white`（白） | `red`、`black`                                               | 输入错误时会自动使用默认颜色（黑色），并在命令行提示         |
| 4        | 位置     | 仅支持 3 种固定位置（小写，含空格需用引号包裹）：`left top`（左上角）、`center`（居中）、`right bottom`（右下角） | `"left top"`、`center`                                       | Windows 系统中`left top`和`right bottom`需用英文双引号包裹；Mac/Linux 可直接输入 |

### 3. 目录生成规则

工具会自动在**原图片所在目录的同级目录**创建新目录，命名规则为：`原目录名_watermark`，示例：

- 原图片路径：`E:\Photograph\1.jpg`（原目录为`E:\Photograph`）；
- 水印图片保存路径：`E:\Photograph_watermark\1.jpg`（新目录`Photograph_watermark`与原目录同级）；
- 若新目录已存在，直接在目录下保存图片（不会覆盖已有文件，重名时会自动处理）。

## 四、操作示例（分系统）

### 1. Windows 系统示例

#### 示例 1：绝对路径 + 左上角红色水印

需求：给`E:\Photograph\202405.jpg`添加 14 号红色水印，位置为左上角。

```powershell
# 步骤1：进入target目录（假设工具在E盘项目目录下）
cd E:\研一课程\大语言模型辅助软件工程\作业1\Photo-Watermark-1\image-watermark-tool\target

# 步骤2：执行命令（路径含空格，用双引号包裹）
java -jar image-watermark-tool-1.0-SNAPSHOT.jar "E:\Photograph\202405.jpg" 14 red "left top"
```

#### 示例 2：相对路径 + 右下角黑色水印

需求：给当前命令行所在目录下的`test.png`添加 16 号黑色水印，位置为右下角（当前目录需包含`test.png`）。

```powershell
# 步骤1：进入图片所在目录
cd E:\Photos

# 步骤2：执行命令（工具JAR用绝对路径，图片用相对路径）
java -jar "E:\研一课程\大语言模型辅助软件工程\作业1\Photo-Watermark-1\image-watermark-tool\target\image-watermark-tool-1.0-SNAPSHOT.jar" test.png 16 black "right bottom"
```

### 2. MacOS/Linux 系统示例

需求：给`/Users/me/Photos/trip.jpg`添加 18 号白色水印，位置为居中。

```bash
# 步骤1：进入target目录
cd /Users/me/projects/Photo-Watermark-1/image-watermark-tool/target

# 步骤2：执行命令（Mac/Linux含空格路径用双引号或反斜杠转义）
java -jar image-watermark-tool-1.0-SNAPSHOT.jar "/Users/me/Photos/trip.jpg" 18 white center
```

## 五、常见问题与解决方案

### 1. 运行报错：“Unable to access jarfile xxx.jar”

- **原因**：命令行当前目录与 JAR 包所在目录不匹配，或 JAR 包路径输入错误。

- 解决方案

  ：

  1. 用`cd`命令进入`target`目录（JAR 包所在目录）；
  2. 若不进入目录，需在命令中写 JAR 包的完整路径（如`java -jar "/E:/xxx/target/xxx.jar"`）；
  3. 检查 JAR 包文件名是否与命令中一致（区分大小写，如`ImageWatermark.jar`≠`imagewatermark.jar`）。

### 2. 运行报错：“找不到或无法加载主类 com.example.ImageWatermark”

- **原因**：`pom.xml`中`mainClass`配置与主类实际包名不匹配，或主类未编译。

- 解决方案

  ：

  1. 确认`ImageWatermark.java`开头的`package`声明（如`package com.example;`）；
  2. 确保`pom.xml`中`mainClass`为完整路径（如`<mainClass>com.example.ImageWatermark</mainClass>`）；
  3. 重新执行`mvn clean package`，确保编译无错误（日志无红色`BUILD FAILURE`）。

### 3. 水印使用当前日期而非拍摄时间

- **原因**：图片无 EXIF 拍摄时间（如截图、人工处理过的图片），或图片格式不支持 EXIF（如部分 PNG）。

- 解决方案

  ：

  1. 确认图片为原始拍摄图片（非截图、非压缩后的图片）；
  2. 用图片查看工具（如 Windows 照片查看器）检查 “属性 - 详细信息”，确认 “拍摄日期” 存在；
  3. 若仍无拍摄时间，工具会自动用当前日期（正常现象，命令行有`Warning: No EXIF date found`提示）。

### 4. 保存水印图片时报 “Unsupported image format”

- **原因**：图片格式不支持（如 BMP、GIF），或图片文件损坏。

- 解决方案

  ：

  1. 将图片转换为 JPEG 或 PNG 格式（用画图工具、Photoshop 等）；
  2. 检查原图片是否能正常打开，排除文件损坏问题。

## 六、错误提示与含义

工具运行时会输出明确的提示信息，帮助定位问题，常见提示如下：

| 提示信息                                          | 含义                     | 处理建议                                            |
| ------------------------------------------------- | ------------------------ | --------------------------------------------------- |
| `Watermarked image saved to: [路径]`              | 水印添加成功             | 前往提示路径查看水印图片                            |
| `Warning: No EXIF date found, using current date` | 图片无 EXIF 拍摄时间     | 正常现象，水印使用当前日期                          |
| `Error: Image file not found or not a valid file` | 图片路径错误或文件不存在 | 检查图片路径是否正确，文件是否被删除                |
| `Error: Font size must be an integer`             | 字体大小输入非整数       | 改为正整数（如`14`，而非`14.5`、`abc`）             |
| `Unknown color. Defaulting to black`              | 颜色参数错误             | 仅使用支持的 5 种颜色（red/green/blue/black/white） |
| `Failed to create directory: [路径]`              | 无法创建水印目录         | 检查目录路径是否有权限（如 C 盘根目录需管理员权限） |

## 七、维护与更新

### 1. 后续功能扩展

- 支持批量处理：可修改代码，遍历指定目录下所有图片并添加水印；
- 支持更多颜色：扩展`getColor`方法，增加`yellow`、`cyan`等颜色，或支持 RGB 值（如`255,0,0`）；
- 支持自定义水印文本：增加参数，允许用户输入自定义文本（而非仅拍摄时间）。

### 2. 版本更新

- 若需更新工具，只需修改代码后重新执行`mvn clean package`，生成新的 JAR 包；
- 更新依赖库（如`metadata-extractor`）时，修改`pom.xml`中依赖的`version`，重新打包即可。

## 八、联系方式

若遇到手册未覆盖的问题，可通过以下方式获取帮助：

- 检查项目代码注释（关键方法均有功能说明）；
- 参考`metadata-extractor`官方文档（https://drewnoakes.com/code/exif/）；
- 确认 Java 环境配置（参考 Oracle Java 官方文档）。

通过以上指南，可快速掌握工具的使用方法，高效完成图片水印添加任务。